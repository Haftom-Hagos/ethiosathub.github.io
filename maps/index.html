<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EGSH-Map</title>

  <!-- Leaflet + Draw -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />

  <!-- Optional: your styles.css if you have one. Keep it, or use the embedded fallback below -->
  <link rel="stylesheet" href="../styles.css" />

  <style>
    /* Minimal fallback styling (keeps layout usable even if styles.css missing) */
    body { font-family: Arial, Helvetica, sans-serif; margin:0; padding:0; }
    .navbars { background:#0a5; padding:10px; color:#fff; }
    .nav-container { display:flex; justify-content:space-between; align-items:center; max-width:1200px; margin:0 auto; }
    .nav-logo a { color:#fff; text-decoration:none; font-weight:700; font-size:18px; }
    #map { height: 70vh; width: 100%; border: 1px solid #ddd; }
    .filters { margin:10px 0; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .button-container { margin:10px 0; }
    .legend { background: rgba(255,255,255,0.95); padding:10px; border-radius:6px; box-shadow:0 1px 5px rgba(0,0,0,0.2); max-width:260px; }
    #legend-container { position: absolute; top:90px; right:10px; z-index: 1000; }
    .legend h4 { margin:0 0 8px 0; font-size:14px; }
    .btn { background:#2b7; color:#003; padding:6px 10px; border-radius:4px; text-decoration:none; display:inline-block; margin-top:6px; }
    .filters label { font-size:14px; }
  </style>
</head>
<body>
  <nav class="navbars">
    <div class="nav-container">
      <div class="nav-logo"><a href="/home">EGSH</a></div>
      <div>
        <span style="font-weight:700">Maps</span>
      </div>
    </div>
  </nav>

  <div style="max-width:1200px;margin:12px auto;padding:0 12px;">
    <h2>Map view</h2>
    <p>Select a dataset (NDVI or Land Cover), choose dates, and draw an area or pick a district. Use the buttons to view or download.</p>

    <div id="map"></div>

    <div class="filters">
      <label for="datasetSelect">Dataset:</label>
      <select id="datasetSelect">
        <option value="">Select Dataset</option>
        <option value="ndvi">NDVI (Sentinel-2)</option>
        <option value="dw">Land Cover (Dynamic World)</option>
      </select>

      <div id="geeOptions" style="display:none;">
        <label for="yearSelect">Year:</label>
        <select id="yearSelect"></select>

        <label for="monthStart">From:</label>
        <select id="monthStart"></select>

        <label for="monthEnd">To:</label>
        <select id="monthEnd"></select>
      </div>

      <label for="districtSelect">District:</label>
      <select id="districtSelect">
        <option value="">Select a district</option>
      </select>

      <label><input type="checkbox" id="overlay-toggle" checked /> Show overlay</label>
    </div>

    <div class="button-container">
      <button id="viewSelectionBtn">View Selection</button>
      <button id="downloadSelectionBtn">Download Selection</button>
    </div>

    <!-- Legend container (two separate small legends, toggled by JS) -->
    <div id="legend-container">
      <div id="ndvi-legend" class="legend" style="display:none"></div>
      <div id="dw-legend" class="legend" style="display:none"></div>
    </div>

    <div style="margin-top:12px;">
      <a class="btn" href="https://ethiosathub-gee.projects.earthengine.app/view/vegind" target="_blank">Open Vegetation Indices App</a>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
  <script src="https://unpkg.com/esri-leaflet"></script>
  <script src="https://unpkg.com/proj4@2.7.5/dist/proj4.js"></script>

  <!-- Your application script -->
  <script src="../script.js"></script>

  <script>
    // Small UI glue: toggle GEE options visibility
    const datasetSelect = document.getElementById('datasetSelect');
    const geeOptions = document.getElementById('geeOptions');

    datasetSelect.addEventListener('change', () => {
      const v = datasetSelect.value;
      geeOptions.style.display = (v === 'ndvi' || v === 'dw') ? 'inline-block' : 'none';
      // show appropriate legend containers (script.js will fill them)
      document.getElementById('ndvi-legend').style.display = 'none';
      document.getElementById('dw-legend').style.display = 'none';
    });
  </script>
</body>
</html>
